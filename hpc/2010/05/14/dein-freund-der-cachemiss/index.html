
<!DOCTYPE html>
<html lang="de">
  <head>
    <meta charset="utf-8">
    <title>
      
        Dein Freund der Cachemiss - 
      
      0rph3us
    </title>
    
    <meta name="author" content="Michael Rennecke">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- HTML5 shim, for IE6-8 support of HTML elements -->
    <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <link href="/assets/themes/hooligan/bootstrap/css/bootstrap.min.css" rel="stylesheet">
    <link href="/assets/themes/hooligan/bootstrap/css/bootstrap-responsive.min.css" rel="stylesheet">
    <link rel="stylesheet" type="text/css" href="/assets/themes/hooligan/css/zocial.stripped.css">
    <link href="/assets/themes/hooligan/css/syntax.css" rel="stylesheet" type="text/css" media="all">
    <link href="/assets/themes/hooligan/css/darkstrap.css" rel="stylesheet" type="text/css" media="all">
    <link href="/assets/themes/hooligan/css/style.css?body=1" rel="stylesheet" type="text/css" media="all">
    <link href="/assets/themes/hooligan/css/lightbox.css" rel="stylesheet" type="text/css" media="all" />

    
<!-- 
    <script type="text/javascript" src="/js/jquery-1.11.1.min.js"></script>
    <script type="text/javascript" src="/js/lightbox.min.js"></script>
-->

    <!-- jquery-1.11.1.min.js and lightbox.min.js -->
    <script type="text/javascript" src="/js/a63bb257b0d48f7901f938d2f1217cbb.js"></script>

    <!-- fav and touch icons -->
    <!-- Update these with your own images
      <link rel="shortcut icon" href="images/favicon.ico">
      <link rel="apple-touch-icon" href="images/apple-touch-icon.png">
      <link rel="apple-touch-icon" sizes="72x72" href="images/apple-touch-icon-72x72.png">
      <link rel="apple-touch-icon" sizes="114x114" href="images/apple-touch-icon-114x114.png">
    -->
  </head>

  <body>
    <div id="page-wrap">
      <div class="navbar">
        <div class="navbar-inner">
          <div class="container">
            <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
            <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
            </a>

            <a class="brand" href="/">0rph3us</a>

            <div class="nav-collapse">
              <ul class="nav">
                
                
                


  
    
      
    
  
    
      
      	
      	<li><a href="/about.html">Ãœber mich</a></li>
      	
      
    
  
    
      
      	
      	<li><a href="/archive.html">Archiv</a></li>
      	
      
    
  
    
      
    
  
    
      
      	
      	<li><a href="/categories.html">Kategorien</a></li>
      	
      
    
  
    
      
    
  
    
      
    
  
    
      
      	
      	<li><a href="/pages.html">Seiten</a></li>
      	
      
    
  
    
      
    
  
    
      
    
  
    
      
      	
      	<li><a href="/tags.html">Tags</a></li>
      	
      
    
  



              </ul>
              <ul class="nav pull-right social visible-desktop">
                <li class="divider-vertical"></li>
                
                <li>
                  <a href="https://github.com/0rph3us" class="zocial github icon" target="_blank">
                    <span class="hidden-desktop">Github</span>
                  </a>
                </li>
                
                
                
                <li>
                  <a href="https://twitter.com/0rph3us" class="zocial twitter icon" target="_blank">
                    <span class="hidden-desktop">Twitter</span>
                  </a>
                </li>
                
                
                
                
                
                <li>
                  <a href="https://0rph3us.github.io/rss.xml" class="zocial rss icon" target="_blank">
                    <span class="hidden-desktop">RSS Feed</span>
                  </a>
                </li>
                
              </ul>
            </div>
          </div>
        </div>
      </div>

      <div class="container">
        <div class="content">
          
<div class="page-header">
  <h1>
    Dein Freund der Cachemiss 
    
  </h1>
</div>

<div class="row">
  <div class="span8">
    <p>
Ich habe in meinen <a href="http://0rpheus.net/hpc/superlinearer-speedup">letzten Eintrag &uuml;ber Superlinearen Speedup</a> geschrieben. Caching Effekte lassen sich auch in sequenziellen Programmen ausnutzen. So kann man l&auml;sst sich die klassische Matrixmultiplikation um Gr&ouml;&szlig;enordnungen beschleunigen.</p>
<p>
Dazu muss man nur die Matrix B transponiert abspeichern. Wenn man jetzt duch die Spalten der Matrix B geht hat man eine h&ouml;here Lokalit&auml;t und damit weniger Cachemisses.</p>
<pre lang="cpp">
#include <iostream>
#include <stdlib.h>
#include <time.h>

using namespace std;

void mul(double *A, double *B, double *C, int dim)
{
    int i, j, k;
    double s;

    for (i = 0; i < dim; i++){
        for (j = 0; j < dim; j++) {
            s = 0.0;
            for (k = 0; k < dim; ++k)
                s += A[dim*i +k] * B[dim*k+j];

            C[dim*i+j] = s;
        }
    }
}

void transpose(double *A, int dim){

        int i,j;
        double tmp;

    for (i = 0; i < dim; i++){
        for (j = i; j < dim; j++){
            tmp = A[dim*i+j];
            A[dim*i+j] =A[dim*j+i];
            A[dim*j+i] = tmp;
        }
    }

}

void mulfast(double *A, double *B, double *C, int dim)
{
    int i, j, k;
    double s;

    transpose(B, dim);

    for (i = 0; i < dim; ++i){
        for (j = 0; j < dim; ++j) {
            s = 0.0;
            for (k = 0; k < dim; ++k)
                // B is transposed !!
                s += A[dim*i +k] * B[dim*j+k];

            C[dim*i+j] = s;
        }
    }

    transpose(B, dim);
}

int main(){

    int dim = 1024;
    clock_t start, end;

    double* A = (double*) calloc(dim* dim, sizeof(double));
    double* B = (double*) calloc(dim* dim, sizeof(double));
    double* C = (double*) calloc(dim* dim, sizeof(double));

    start = clock();
    mul(A,B,C, dim);
    end = clock();
    cout << "normal implementation: " << (end-start) / CLOCKS_PER_SEC << " seconds" << endl;

    start = clock();
    mulfast(A,B,C, dim);
    end = clock();
    cout << "fast implementation: " << (end-start) / CLOCKS_PER_SEC << " seconds" << endl;

    return 0;
}
</time.h></stdlib.h></iostream></pre>

    <hr>
    <div class="pagination btn-group">
      
        <a class="btn prev" href="/sonstiges/2010/05/02/ich-bin-ein-robot/" title="Ich bin ein robot">&larr; &Auml;lter</a>
      
        <a class="btn" href="/archive.html">Archiv</a>
      
        <a class="btn next" href="/hpc/2010/05/14/superlinearer-speedup/" title="Superlinearer Speedup">Neuer &rarr;</a>
      
    </div>
    





  </div>
  
  <div class="span4">
    <section>
      <h4>Ver&ouml;ffentlicht</h4>
      <div class="date"><span>14.05.2010</span></div>
    </section>
    <section>
      <h4>Letzte &Auml;nderung</h4>
      <div class="date"><span></span>26.06.2014 18:32 Uhr</div>
    </section>
         
    
      <section>
        <h4>Tags</h4>
        <ul class="tag_box">
          
          


  
     
    	<li><a href="/tags.html#Cache-ref">Cache <span>2</span></a></li>
     
    	<li><a href="/tags.html#C++-ref">C++ <span>4</span></a></li>
    
  



        </ul>
      </section>
             
  </div>
</div>


        </div>
        <hr>
      </div> <!-- /container -->

      <div class="footer-push"></div>
    </div><!--/.page-wrap -->

    <footer>
      <div class="container">
        <p>&copy; 2015 Michael Rennecke, some rights reserved</p>
        <p>Diese Seite ist unter der <a href="http://creativecommons.org/licenses/by-sa/4.0/">Creative Commons Attribution-ShareAlike 4.0 International License</a> lizenziert.</p>
      </div>
    </footer>

    <script>window.jQuery || document.write('<script src="/assets/themes/hooligan/js/jquery.min.js"><\/script>')</script>
    <script type="text/javascript" src="/assets/themes/hooligan/bootstrap/js/bootstrap.min.js"></script>

    
  </body>
</html>

