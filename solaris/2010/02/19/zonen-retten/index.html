
<!DOCTYPE html>
<html lang="de">
  <head>
    <meta charset="utf-8">
    <title>
      
        Zonen retten - 
      
      0rph3us
    </title>
    
    <meta name="author" content="Michael Rennecke">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- HTML5 shim, for IE6-8 support of HTML elements -->
    <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <link href="/assets/themes/hooligan/bootstrap/css/bootstrap.min.css" rel="stylesheet">
    <link href="/assets/themes/hooligan/bootstrap/css/bootstrap-responsive.min.css" rel="stylesheet">
    <link href="/assets/themes/hooligan/css/bar.css" rel="stylesheet" type="text/css" media="all" />
<!--    <link href="/assets/themes/hooligan/css/zocial.stripped.css" rel="stylesheet" type="text/css">
    <link href="/assets/themes/hooligan/css/syntax.css" rel="stylesheet" type="text/css" media="all">
    <link href="/assets/themes/hooligan/css/darkstrap.css" rel="stylesheet" type="text/css" media="all">
    <link href="/assets/themes/hooligan/css/style.css?body=1" rel="stylesheet" type="text/css" media="all">
    <link href="/assets/themes/hooligan/css/lightbox.css" rel="stylesheet" type="text/css" media="all" />
-->
    
<!-- 
    <script type="text/javascript" src="/js/jquery-1.11.1.min.js"></script>
    <script type="text/javascript" src="/js/lightbox.min.js"></script>
-->

    <!-- jquery-1.11.1.min.js and lightbox.min.js -->
    <script type="text/javascript" src="/js/a63bb257b0d48f7901f938d2f1217cbb.js" async></script>

    <!-- fav and touch icons -->
    <!-- Update these with your own images
      <link rel="shortcut icon" href="images/favicon.ico">
      <link rel="apple-touch-icon" href="images/apple-touch-icon.png">
      <link rel="apple-touch-icon" sizes="72x72" href="images/apple-touch-icon-72x72.png">
      <link rel="apple-touch-icon" sizes="114x114" href="images/apple-touch-icon-114x114.png">
    -->
  </head>

  <body>
    <div id="page-wrap">
      <div class="navbar">
        <div class="navbar-inner">
          <div class="container">
            <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
            <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
            </a>

            <a class="brand" href="/">0rph3us</a>

            <div class="nav-collapse">
              <ul class="nav">
                
                
                


  
    
      
    
  
    
      
      	
      	<li><a href="/about.html">Über mich</a></li>
      	
      
    
  
    
      
      	
      	<li><a href="/archive.html">Archiv</a></li>
      	
      
    
  
    
      
    
  
    
      
      	
      	<li><a href="/categories.html">Kategorien</a></li>
      	
      
    
  
    
      
    
  
    
      
    
  
    
      
      	
      	<li><a href="/pages.html">Seiten</a></li>
      	
      
    
  
    
      
    
  
    
      
    
  
    
      
      	
      	<li><a href="/tags.html">Tags</a></li>
      	
      
    
  



              </ul>
              <ul class="nav pull-right social visible-desktop">
                <li class="divider-vertical"></li>
                
                <li>
                  <a href="https://github.com/0rph3us" class="zocial github icon" target="_blank">
                    <span class="hidden-desktop">Github</span>
                  </a>
                </li>
                
                
                
                <li>
                  <a href="https://twitter.com/0rph3us" class="zocial twitter icon" target="_blank">
                    <span class="hidden-desktop">Twitter</span>
                  </a>
                </li>
                
                
                
                
                
                <li>
                  <a href="https://0rph3us.github.io/rss.xml" class="zocial rss icon" target="_blank">
                    <span class="hidden-desktop">RSS Feed</span>
                  </a>
                </li>
                
              </ul>
            </div>
          </div>
        </div>
      </div>

      <div class="container">
        <div class="content">
          
<div class="page-header">
  <h1>
    Zonen retten 
    
  </h1>
</div>

<div class="row">
  <div class="span8">
    <p>Ich habe mir vor einigen Wochen meine Systemplatten zerstört. Das hat mich noch nicht sonderlich gestört. Denn man kann OpenSolaris sehr schnell wieder installieren. Von den ganzen Konfigurationen hatte ich ein Backup. Ein kleineres Problem hatte ich mit den Zonen. Sie ließen sich nicht ohne weiteres im neuen System importieren. Ein möglicher Grund ist, dass ich sie nicht detachet hatte und die Zoneroots hatte ich auch nicht mehr.<br />
 Der Fehler hat sich wie folgt geäußert:</p>
<pre lang="bash">rennecke@walhalla ~ $ pfexec zoneadm -z test attach -u
Log File: /var/tmp/test.attach_log.KvayPK
ERROR: no active dataset.
rennecke@walhalla ~ $ pfexec zoneadm -z test attach
Log File: /var/tmp/test.attach_log.X4aOcK
ERROR: no active dataset.
rennecke@walhalla ~ $ pfexec cat /var/tmp/test.attach_log.X4aOcK
[Montag, 15. Februar 2010, 12:45:18 Uhr CET] Log File: /var/tmp/test.attach_log.X4aOcK
[Montag, 15. Februar 2010, 12:45:18 Uhr CET] ERROR: no active dataset.</pre>
<p>Also habe ich etwas gebastelt und habe die Zonen wieder importiert.</p>
<ol>
<li>Das Backup von <tt>/etc/zones</tt> eingespielt</li>
<li>Den zpool mit den zonen importiert, mit der Option <strong>-f</strong></li>
<li> ID des Parent Bootenvironment auslesen:
<pre lang="bash">rennecke@walhalla ~ $ zfs get -r org.opensolaris.libbe:uuid rpool/ROOT
...                                  -
rpool/ROOT/opensolaris          org.opensolaris.libbe:uuid  642ced7d-55a2-cc3b-fbdf-fbdda1c33ebc  local
...</pre>
</li>
<li> Das höchste Bootenvironment der Zone bestimmen. Das ist die höchste Nummer:
<pre lang="bash">rennecke@walhalla ~ $ zfs get -r org.opensolaris.libbe:parentbe
...
daten/zone/test/ROOT/zbe-10                      org.opensolaris.libbe:parentbe  5741bca6-d793-454e-ad53-84c2cf7c630b  local
...</pre>
</li>
<li> ID des Parent Bootenvironment setzten:
<pre lang="bash">rennecke@walhalla ~ $ pfexec zfs set org.opensolaris.libbe:parentbe=642ced7d-55a2-cc3b-fbdf-fbdda1c33ebc daten/zone/test/ROOT/zbe-10</pre>
</li>
<li>Status der Zone in der Datei <tt>/etc/zones/index</tt> auf <strong>configured</strong> setzten</li>
<li>Zone neu installieren:
<pre lang="bash">rennecke@walhalla ~ $ pfexec zoneadm -z test install</pre>
</li>
<li> Testen, ob die Zone sich <strong>nicht</strong> booten lässt:
<pre lang="bash">rennecke@walhalla ~ $ pfexec zoneadm -z test boot</pre>
<p>Es sollte ein Fehler kommen, dass es mehrere aktive Datasets gibt.</p>
</li>
<li>Das neu angelegte Bootenvironment der Zone löschen:
<pre lang="bash">rennecke@walhalla ~ $ pfexec zfs destroy daten/zone/test/ROOT/zbe-11</pre>
</li>
<li>Fertig, nun kann man die Zone wieder normal booten</li>
</ol>
<p>Diese Unschönheit kommt bei Solaris 10 nicht vor. Es kann sein, dass sie auch nur bei den, von mir verwendten Build 131 vorkommt. Man sollte bei dieser Bastelei wissen was man tut, also bitte nicht wild darauf los tippen, wenn ihr den selben Fehler habt.</p>

    <hr>
    <div class="pagination btn-group">
      
        <a class="btn prev" href="/solaris/tools/2010/02/08/virtual-box-clienten-auf-raw-devices/" title="Virtual Box-Clienten auf raw-Devices">&larr; &Auml;lter</a>
      
        <a class="btn" href="/archive.html">Archiv</a>
      
        <a class="btn next" href="/solaris/2010/02/24/opensolaris-auf-einer-v880-installieren/" title="OpenSolaris auf einer V880 installieren">Neuer &rarr;</a>
      
    </div>
    





  </div>
  
  <div class="span4">
    <section>
      <h4>Ver&ouml;ffentlicht</h4>
      <div class="date"><span>19.02.2010</span></div>
    </section>
    <section>
      <h4>Letzte &Auml;nderung</h4>
      <div class="date"><span></span>26.06.2014 18:32 Uhr</div>
    </section>
         
    
      <section>
        <h4>Tags</h4>
        <ul class="tag_box">
          
          


  
     
    	<li><a href="/tags.html#zone-ref">zone <span>4</span></a></li>
     
    	<li><a href="/tags.html#OpenSolaris-ref">OpenSolaris <span>25</span></a></li>
    
  



        </ul>
      </section>
             
  </div>
</div>


        </div>
        <hr>
      </div> <!-- /container -->

      <div class="footer-push"></div>
    </div><!--/.page-wrap -->

    <footer>
      <div class="container">
        <p>&copy; 2015 Michael Rennecke, some rights reserved</p>
        <p>Diese Seite ist unter der <a href="http://creativecommons.org/licenses/by-sa/4.0/">Creative Commons Attribution-ShareAlike 4.0 International License</a> lizenziert.</p>
      </div>
    </footer>

    <script>window.jQuery || document.write('<script src="/assets/themes/hooligan/js/jquery.min.js"><\/script>')</script>
    <script type="text/javascript" src="/assets/themes/hooligan/bootstrap/js/bootstrap.min.js"></script>

    
  </body>
</html>

