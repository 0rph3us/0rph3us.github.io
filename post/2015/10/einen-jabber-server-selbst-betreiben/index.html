<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="de-DE" lang="de-DE">

<head>
  <title>
    Einen Jabber Server selbst betreiben // Michael im Netz
  </title>

  <link href="http://gmpg.org/xfn/11" rel="profile">
<meta http-equiv="content-type" content="text/html; charset=utf-8">


<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

<meta name="description" content="">
<meta name="keywords" content="">
<meta name="author" content="">
<meta name="generator" content="Hugo 0.15-DEV" />

  <meta property="og:title" content="Einen Jabber Server selbst betreiben" />
<meta property="og:description" content="" />
<meta property="og:type" content="website" />
<meta property="og:locale" content="en_US" />
<meta property="og:url" content="https://0rph3us.github.io/post/2015/10/einen-jabber-server-selbst-betreiben/" />


  
  
  

    
    
    <link rel="stylesheet" href="https://0rph3us.github.io/css/6c4ae43c-ac4d-4a71-ab4f-4cd485c2ac5f.css">

  
  


  
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/touch-icon-144-precomposed.png">
  <link rel="shortcut icon" href="/favicon.png">

    
  
  <link rel="stylesheet" href="https://0rph3us.github.io/css/solarized_light-8.7.min.css">
  
  <script src="https://0rph3us.github.io/js/highlight-8.7.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script>


  

  

  
</head>

<body>
	

	<div id="layout" class="pure-g">
    <div class="sidebar pure-u-1 pure-u-md-1-4">
  <div class="header">
    

	

    <h1 class="brand-title"><a href="https://0rph3us.github.io">Michael Rennecke</a></h1>
    <h2 class="brand-tagline">Meine Gedanken zu Sicherheit, Linux und Random Stuff</h2>

    <nav class="nav">
      <ul class="nav-list">
        <li class="nav-item"><span class="nav-item-separator">//</span><a href="https://0rph3us.github.io">Home</a></li>
        
          <li class="nav-item"><span class="nav-item-separator">//</span><a href="/about/">Über mich</a></li>
        
          <li class="nav-item"><span class="nav-item-separator">//</span><a href="/links/">Links</a></li>
        
          <li class="nav-item"><span class="nav-item-separator">//</span><a href="/spickzettel/">Spickzettel</a></li>
        
      </ul>
    </nav>

    
    <div class="zozial-buttons">
      
        
        <a href="https://github.com/0rph3us" target="_blank"><i class='fa fa-github'></i></a>
        
      
        
        <a href="https://twitter.com/0rph3us" target="_blank"><i class='fa fa-twitterhack'></i></a>
        
      
        
        <a href="https://0rph3us.github.io/rss.xml" target="_blank"><i class='fa fa-rss'></i></a>
        
      
      
    </div>
    

  </div>
</div>

	
	

    <div class="content pure-u-1 pure-u-md-3-4">
		<a id="top"></a>
		

		
			
		    <div id="toc" class="pure-u-1 pure-u-md-1-4">
				<small class="toc-label">Inhalt</small>
		   	 	<nav id="TableOfContents">
<ul>
<li>
<ul>
<li><a href="#installation:9cdd19a5faf21f7205a2e96d6a467276">Installation</a></li>
<li><a href="#konfiguration:9cdd19a5faf21f7205a2e96d6a467276">Konfiguration</a></li>
</ul></li>
</ul>
</nav>
		    </div>
		    
	    
  		<section class="post">
            <h1 class="post-title">
              <a href="/post/2015/10/einen-jabber-server-selbst-betreiben/">Einen Jabber Server selbst betreiben</a>
            </h1>
            <h3 class="post-subtitle">
            	
            </h3>
            
            	<span class="post-date">
                	<span class="post-date-day"><sup>25</sup></span><span class="post-date-separator">/</span><span class="post-date-month"> Oktober</span> <span class="post-date-year">2015</span>
            	</span>
            	
            
            	
            

			
			
				<div class="post-categories">
				
					<a class="post-category post-category-tools" href="https://0rph3us.github.io/categories/tools">Tools</a>
				
					<a class="post-category post-category-linux" href="https://0rph3us.github.io/categories/linux">Linux</a>
				
					<a class="post-category post-category-raspberry-pi" href="https://0rph3us.github.io/categories/raspberry-pi">Raspberry Pi</a>
				
				</div>
			

			

			

            

<p>Am 30.09.2015 war <code>jabber.ccc.de</code> für <a href="https://ccc.de/de/updates/2015/jabbercccde">2 Tage nicht verfügbar</a>.
Das hat mich motiviert endlich einen eigenen jabber-Server zu
betreiben.</p>

<p>Hinter Jabber steckt das offene Protokoll <a href="Extensible Messaging and Presence Protocol">XMPP</a>, welches dem
<a href="https://de.wikipedia.org/wiki/Extensible_Markup_Language">XML</a> Standard folgt und für Instant Messaging (Chats) genutzt wird.
Ich habe mich für <a href="http://prosody.im/">Prosody</a> als Jabber-Server entschieden. Für
Prosody sprechen, aus meiner Sicht, seine einefache Konfiguration
sowie seine Schlankheit. Eine Alternatibe ist <a href="https://www.ejabberd.im/">ejabberd</a>.</p>

<h2 id="installation:9cdd19a5faf21f7205a2e96d6a467276">Installation</h2>

<p>Damit man Prosody installieren kann, sollte man das Repository
der Entwickler einbinden. Ich nehme auch bei <code>jessie</code> als
Distribution <code>whezzy</code>, weil <a href="https://de.wikipedia.org/wiki/Transport_Layer_Security">TLS</a> mit mit den <code>jessie</code> Paketen
nicht funktioniert.</p>

<pre><code class="language-sh"># zu root werden bzw. sudo vor echo und tee schreiben
echo deb http://packages.prosody.im/debian wheezy main | tee -a /etc/apt/sources.list.d/prosody.list
wget https://prosody.im/files/prosody-debian-packages.key -O- | sudo apt-key add -
</code></pre>

<p>Nun kann man Prosody installieren</p>

<pre><code class="language-sh">apt-get update &amp;&amp; apt-get install prosody lua-sec-prosody
</code></pre>

<p>Das Paket <code>lua-sec-prosody</code> wird für TLS benötigt. Wenn man die aktuellste Version
installieren möchte, dann muss man das <code>prosody-0.10</code> statt <code>prosody</code> installieren.
Ich habe bis jetzt keine Probleme mit den nighly Builds gehabt.</p>

<h2 id="konfiguration:9cdd19a5faf21f7205a2e96d6a467276">Konfiguration</h2>

<p>Die Konfiguration wird in <code>/etc/prosody/prosody.cfg.lua</code> erledigt. Als erstes
In der Zeile <code>admins = { &quot;admin@jabber.0rpheus.net&quot; }</code> kann gleich
ein entsprechender Admin eingetragen werden. Um zusätzliche User
anzulegen gibt es zwei Möglichkeiten. Entweder direkt über einen
Jabber Client oder auf Zuruf durch einen Administrator. Ersteres
würde bedeuteten, dass sich jeder, der den Server kennt,
registrieren kann. Dazu muss die Zeile <code>allow_registration = false;</code>
auf <code>allow_registration = true;</code> geändert werden. Einen Nutzer
legt so an:</p>

<pre><code class="language-sh">prosodyctl adduser foo@jabber.0rpheus.net
</code></pre>

<p>Als nächstes wird die Domain konfiguriert.</p>

<pre><code class="language-lua">VirtualHost &quot;jabber.0rpheus.net&quot;
        enabled = true

        -- Assign this host a certificate for TLS, otherwise it would use the one
        -- set in the global section (if any).
        -- Note that old-style SSL on port 5223 only supports one certificate, and will always
        -- use the global one.
        ssl = {
                ciphers     = &quot;AES256+EECDH:AES256+EDH:AES128+EECDH:AES128+EDH&quot;;
                key         = &quot;/etc/prosody/certs/jabber.0rpheus.net.key&quot;;
                certificate = &quot;/etc/prosody/certs/jabber.0rpheus.net.crt&quot;;
                dhparam     = &quot;/etc/prosody/certs/dh-4096.pem&quot;;
                protocol    = &quot;tlsv1_2&quot;;
        }
</code></pre>

<p>Die globalen SSL Einstellungen können entweder entfernt oder
ebenfalls mit denselben Werten nochmal befüllt werden.</p>

<p>Per Default speichert Prosody die Passwörter im Klartext ab,
um mit alten Clients kompatibel zu sein. Wer das nicht möchte bzw.
nicht braucht, kann die Passwörter gehashed abspeichern.
Dazu muss eine zusätzliche Zeile hinzugefügt werden.</p>

<pre><code class="language-lua">authentication = &quot;internal_hashed&quot;
</code></pre>

<p>Um die Änderungen zu aktivieren, muss der Prosody Dienst
einmal durchgestartet werden.</p>

<pre><code class="language-sh">systemctl restart prosody
</code></pre>

<p>Folgende Portfreischaltungen werden für einen reibungslosen Betrieb noch benötigt.</p>

<p>Port 5222 eingehend = Clientverbindungen
Port 5280 eingehend = Clientverbindungen (http-bind)
Port 5281 eingehend = Clientverbindungen (http-bind)
Port 5269 ein- und ausgehend = Verbindung zu fremden Servern</p>

	
			

			
				<div class="tags-list">
					<span class="dark-red">Tags</span><span class="decorative-marker">//</span>
					
	                <a class="post-tag post-tag-xmpp" href="https://0rph3us.github.io/tags/xmpp">xmpp</a>,
	                
	                <a class="post-tag post-tag-jabber" href="https://0rph3us.github.io/tags/jabber">jabber</a>,
	                
	                <a class="post-tag post-tag-prosody" href="https://0rph3us.github.io/tags/prosody">prosody</a>,
	                
				</div>
			

			
				<div class="paging">
					<span class="paging-label">Mehr zum lesen</span>
					

					
					<div class="paging-older">
						<span class="dark-red">Älter</span><span class="decorative-marker">//</span>
			            <a class="paging-link" href="/post/2015/10/images-mit-partionstabellen-mounten/">Images mit Partionstabellen mounten</a>
		            </div>
		            
	            </div>
            
          </section>
          
          	
          
        
      <div class="footer">
	<hr class="thin" />
	<div class="pure-menu pure-menu-horizontal pure-menu-open">
		<ul class="footer-menu">
		
		</ul>
	</div>

	<p>Diese Seite ist unter der <a href="http://creativecommons.org/licenses/by-sa/4.0/">Creative Commons Attribution-ShareAlike 4.0 International License</a> lizenziert.</p>
</div>
    </div>
  </div>
	

	

  

</body>
</html>
