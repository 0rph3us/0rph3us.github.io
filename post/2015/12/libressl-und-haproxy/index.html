<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="de-DE" lang="de-DE">

<head>
  <title>
    LibreSSL und HAProxy // Michael im Netz
  </title>

  <link href="http://gmpg.org/xfn/11" rel="profile">
<meta http-equiv="content-type" content="text/html; charset=utf-8">


<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

<meta name="description" content="">
<meta name="keywords" content="">
<meta name="author" content="">
<meta name="generator" content="Hugo 0.16-DEV" />

  <meta property="og:title" content="LibreSSL und HAProxy" />
<meta property="og:description" content="" />
<meta property="og:type" content="website" />
<meta property="og:locale" content="en_US" />
<meta property="og:url" content="https://0rph3us.github.io/post/2015/12/libressl-und-haproxy/" />


  
  
  

    
    
    <link rel="stylesheet" href="https://0rph3us.github.io/css/6c4ae43c-ac4d-4a71-ab4f-4cd485c2ac5f.css">

  
  


  
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/touch-icon-144-precomposed.png">
  <link rel="shortcut icon" href="/favicon.png">

    
  
  <link rel="stylesheet" href="https://0rph3us.github.io/css/solarized_light-8.7.min.css">
  
  <script src="https://0rph3us.github.io/js/highlight-8.7.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script>


  

  

  
</head>

<body>
	

	<div id="layout" class="pure-g">
    <div class="sidebar pure-u-1 pure-u-md-1-4">
  <div class="header">
    

	

    <h1 class="brand-title"><a href="https://0rph3us.github.io">Michael Rennecke</a></h1>
    <h2 class="brand-tagline">Meine Gedanken zu Sicherheit, Linux und Random Stuff</h2>

    <nav class="nav">
      <ul class="nav-list">
        <li class="nav-item"><span class="nav-item-separator">//</span><a href="https://0rph3us.github.io">Home</a></li>
        
          <li class="nav-item"><span class="nav-item-separator">//</span><a href="/about/">Über mich</a></li>
        
          <li class="nav-item"><span class="nav-item-separator">//</span><a href="/links/">Links</a></li>
        
          <li class="nav-item"><span class="nav-item-separator">//</span><a href="/spickzettel/">Spickzettel</a></li>
        
      </ul>
    </nav>

    
    <div class="zozial-buttons">
      
        
        <a href="https://github.com/0rph3us" target="_blank"><i class='fa fa-github'></i></a>
        
      
        
        <a href="https://twitter.com/0rph3us" target="_blank"><i class='fa fa-twitterhack'></i></a>
        
      
        
        <a href="https://0rph3us.github.io/rss.xml" target="_blank"><i class='fa fa-rss'></i></a>
        
      
      
    </div>
    

  </div>
</div>

	
	

    <div class="content pure-u-1 pure-u-md-3-4">
		<a id="top"></a>
		

		
			
		    <div id="toc" class="pure-u-1 pure-u-md-1-4">
				<small class="toc-label">Inhalt</small>
		   	 	<nav id="TableOfContents">
<ul>
<li>
<ul>
<li><a href="#haproxy:bddda923aec4e8e8e36a0066c730c514">HAProxy</a></li>
<li><a href="#haproxy-mit-libressl-und-pcre-bauen:bddda923aec4e8e8e36a0066c730c514">HAProxy mit LibreSSL und PCRE bauen</a></li>
<li><a href="#todo:bddda923aec4e8e8e36a0066c730c514">ToDo</a></li>
</ul></li>
</ul>
</nav>
		    </div>
		    
	    
  		<section class="post">
            <h1 class="post-title">
              <a href="/post/2015/12/libressl-und-haproxy/">LibreSSL und HAProxy</a>
            </h1>
            <h3 class="post-subtitle">
            	
            </h3>
            
            	<span class="post-date">
                	<span class="post-date-day"><sup>28</sup></span><span class="post-date-separator">/</span><span class="post-date-month"> Dezember</span> <span class="post-date-year">2015</span>
            	</span>
            	
            
            	
            

			
			
				<div class="post-categories">
				
					<a class="post-category post-category-sicherheit" href="https://0rph3us.github.io/categories/sicherheit">Sicherheit</a>
				
					<a class="post-category post-category-linux" href="https://0rph3us.github.io/categories/linux">Linux</a>
				
				</div>
			

			

			

            

<p>Wenn man <a href="https://www.raspbian.org/">Raspbian</a> einsetzt (oder eine fast beliebige andere Linux-Distribution)
hat man das <em>Problem</em>, dass die mitgelieferten Webserver und Loadbalancer <a href="https://www.openssl.org/">OpenSSL</a>
nutzen. OpenSSL ist 2015 durch eine Sicherheitslücken negativ aufgefallen, außerdem
gibt es keine Unterstützung<sup class="footnote-ref" id="fnref:bddda923aec4e8e8e36a0066c730c514:1"><a rel="footnote" href="#fn:bddda923aec4e8e8e36a0066c730c514:1">1</a></sup> für <a href="https://blog.cloudflare.com/do-the-chacha-better-mobile-performance-with-cryptography/">ChaCha20 Cipher Suiten</a>. Diese haben den Vorteil,
dass sie in Software schneller sind als <a href="https://de.wikipedia.org/wiki/Advanced_Encryption_Standard">AES</a>. Das macht sich insbesondere bei meinen
Raspberry Pi und bei Smartphones bemerkbar. Diese haben Hardware AES.</p>

<p><a href="http://www.libressl.org/">LibreSSL</a> ist eine Alternative zu OpenSSL. Es hat die Unterstützung für ChaCha20. Bei
LibreSSL liegt der Fokus auf Sicherheit und weniger auf die Unterstützung von alten
Schnittstellen. Deswegen ist davon auszugehen, dass es in der Zukunft auch weniger
kritische Sicherheitslücken geben wird.</p>

<h2 id="haproxy:bddda923aec4e8e8e36a0066c730c514">HAProxy</h2>

<p>In meinen Setup ist <a href="http://www.haproxy.org/">HAProxy</a> vor dem Webserver (Nginx). Es ist vielleicht sinnlos
einen Loadbalancer auf dem Pi zu nutzen aber ich finde, dass sich HAProxy ein einigen
Stellen einfacher konfigurieren lässt als Nginx.</p>

<h2 id="haproxy-mit-libressl-und-pcre-bauen:bddda923aec4e8e8e36a0066c730c514">HAProxy mit LibreSSL und PCRE bauen</h2>

<p>kopiere das folgende Script in eine Datei und führe es aus:</p>

<pre><code class="language-sh">#!/bin/bash

# names of latest versions of each package
export HAPROXY_VERSION=1.6.3
export VERSION_PCRE=pcre-8.38
export VERSION_LIBRESSL=libressl-2.3.1
export VERSION_HAPROXY=haproxy-$HAPROXY_VERSION

# URLs to the source directories
export SOURCE_LIBRESSL=ftp://ftp.openbsd.org/pub/OpenBSD/LibreSSL/
export SOURCE_PCRE=ftp://ftp.csx.cam.ac.uk/pub/software/programming/pcre/
export SOURCE_HAPROXY=http://www.haproxy.org/download


# clean out any files from previous runs of this script
rm -rf build
mkdir build

# proc for building faster
NB_PROC=$(grep -c ^processor /proc/cpuinfo)

# ensure that we have the required software
#sudo apt-get -y install curl wget build-essential libgd-dev libgeoip-dev checkinstall git

# grab the source files
echo &quot;Download sources&quot;
wget -P ./build &quot;${SOURCE_PCRE}${VERSION_PCRE}.tar.gz&quot;
wget -P ./build &quot;${SOURCE_LIBRESSL}${VERSION_LIBRESSL}.tar.gz&quot;
wget -P ./build &quot;${SOURCE_HAPROXY}/$(echo $HAPROXY_VERSION | cut -d. -f 1-2)/src/$VERSION_HAPROXY.tar.gz&quot;

# expand the source files
echo &quot;Extract Packages&quot;
cd build || exit 1

tar xfz &quot;${VERSION_HAPROXY}.tar.gz&quot;
tar xfz &quot;${VERSION_LIBRESSL}.tar.gz&quot;
tar xfz &quot;${VERSION_PCRE}.tar.gz&quot;
cd ../ || exit 1

export BPATH=&quot;${PWD}/build&quot;
export STATICLIBSSL=&quot;${BPATH}/${VERSION_LIBRESSL}&quot;

# build static LibreSSL
echo &quot;Configure &amp; Build LibreSSL&quot;
cd &quot;${STATICLIBSSL}&quot; || exit 1
./configure --prefix=&quot;${STATICLIBSSL}/_openssl/&quot; --enable-shared=no &amp;&amp; make install-strip -j &quot;${NB_PROC}&quot;

# build pcre
export STATICLIPCRE=&quot;${BPATH}/${VERSION_PCRE}&quot;
cd &quot;${STATICLIPCRE}&quot; || exit 1
./configure --prefix=&quot;${STATICLIPCRE}/_pcre&quot; --enable-shared=no --enable-utf8 --enable-jit
make -j &quot;${NB_PROC}&quot;
make install


echo &quot;Build HAProxy&quot;
cd &quot;${BPATH}/${VERSION_HAPROXY}&quot; || exit 1

make \
-j &quot;${NB_PROC}&quot; \
TARGET=linux2628 \
USE_STATIC_PCRE=1 \
USE_PCRE_JIT=1 \
PCRE_LIB=&quot;${STATICLIPCRE}/_pcre/lib&quot; \
PCRE_INC=&quot;${STATICLIPCRE}/_pcre/include&quot; \
USE_OPENSSL=1 \
SSL_INC=&quot;${STATICLIBSSL}/_openssl/include&quot; \
SSL_LIB=&quot;${STATICLIBSSL}/_openssl/lib&quot; \
USE_ZLIB=1 \
DEFINE=&quot;-fstack-protector --param=ssp-buffer-size=4 -Wformat -Werror=format-security -D_FORTIFY_SOURCE=2&quot;


echo &quot;All done.&quot;
echo &quot;become root and type: &quot;
echo &quot;  cp build/haproxy-${HAPROXY_VERSION}/haproxy /usr/local/sbin&quot;
</code></pre>

<h2 id="todo:bddda923aec4e8e8e36a0066c730c514">ToDo</h2>

<ul>
<li>Konfiguration von HAProxy</li>
</ul>
<div class="footnotes">

<hr />

<ol>
<li id="fn:bddda923aec4e8e8e36a0066c730c514:1">In den kommenden Versionen von OpenSSL wird es Unterstützung für ChaCha20 Cipher Suiten geben. Ich finde die Quelle gerade nicht :-(
 <a class="footnote-return" href="#fnref:bddda923aec4e8e8e36a0066c730c514:1"><sup>[return]</sup></a></li>
</ol>
</div>

	
			

			
				<div class="tags-list">
					<span class="dark-red">Tags</span><span class="decorative-marker">//</span>
					
	                <a class="post-tag post-tag-libressl" href="https://0rph3us.github.io/tags/libressl">LibreSSL</a>,
	                
	                <a class="post-tag post-tag-haproxy" href="https://0rph3us.github.io/tags/haproxy">HAProxy</a>,
	                
	                <a class="post-tag post-tag-raspberry-pi" href="https://0rph3us.github.io/tags/raspberry-pi">Raspberry Pi</a>,
	                
	                <a class="post-tag post-tag-security" href="https://0rph3us.github.io/tags/security">Security</a>,
	                
	                <a class="post-tag post-tag-raspbian" href="https://0rph3us.github.io/tags/raspbian">Raspbian</a>,
	                
				</div>
			

			
				<div class="paging">
					<span class="paging-label">Mehr zum lesen</span>
					

					
					<div class="paging-older">
						<span class="dark-red">Älter</span><span class="decorative-marker">//</span>
			            <a class="paging-link" href="/post/2015/11/continuous-lifecycle-2015/">Continuous Lifecycle 2015</a>
		            </div>
		            
	            </div>
            
          </section>
          
          	
          
        
      <div class="footer">
	<hr class="thin" />
	<div class="pure-menu pure-menu-horizontal pure-menu-open">
		<ul class="footer-menu">
		
		</ul>
	</div>

	<p>Diese Seite ist unter der <a href="http://creativecommons.org/licenses/by-sa/4.0/">Creative Commons Attribution-ShareAlike 4.0 International License</a> lizenziert.</p>
</div>
    </div>
  </div>
	

	

  

</body>
</html>
