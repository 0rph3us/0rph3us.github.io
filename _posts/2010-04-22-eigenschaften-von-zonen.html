---
layout: post
title: Eigenschaften von Zonen
categories:
- Solaris
tags:
- OpenSolaris
- quotas
- Virtualisierung
- zfs
- zone
status: publish
type: post
published: true
meta:
  _edit_last: '2'
  _jd_tweet_this: ''
  _jd_twitter: ''
  _wp_jd_clig: ''
  _wp_jd_bitly: ''
  _wp_jd_wp: ''
  _wp_jd_yourls: ''
  _wp_jd_url: ''
  _wp_jd_target: ''
  _jd_wp_twitter: ''
  _jd_post_meta_fixed: 'true'
author:
  login: rennecke
  email: michael.rennecke@gmail.com
  display_name: Michael Rennecke
  first_name: Michael
  last_name: Rennecke
---
<p>
Ich wurde in Bezug auf diesen <a href="http://0rpheus.net/solaris/eine-zone-in-10-minuten">Blog-Eintrag</a> gefragt, was es f&uuml;r Zoneneigenschaften gibt, welche man f&uuml;r Regelmentierungen verwenden kann.</p>
<p>
Als ersten m&ouml;chte ich zeigen, wie man den Hauptspeicher limitieren kann. </p>
<pre lang="bash">
root@global$ zonecfg -z myzone
zonecfg:myzone> add capped-memory
zonecfg:myzone:capped-memory> set physical=500m
zonecfg:myzone:capped-memory> set swap=1g
zonecfg:myzone:capped-memory> set locked=100m
zonecfg:myzone:capped-memory> end
zonecfg:myzone> exit
</pre>
<dl>
<dt>physical</dt>
<dd>
     Hierbei handelt es sich um eine Limitierung des physischen Hauptspeicher. Wenn mehr Speicher angefordert wird, dann kann dieser ausgelagert werden.<br />
     Eine Zone kann diesen Wert &uuml;berschreiten und mehr Speicher anfordern.
  </dd>
<dt>swap</dt>
<dd>
      Das ist eine Begrenzung des virtuellen Speicher, d.h. eine Zone kann nicht mehr Speicher anfordern. Wenn ein Prozess in der Zone mehr Speicher anfordert, so    schl&auml;gt diese Speicheranforderung fehl.
   </dd>
<dt>locked</dt>
<dd>
     Der allokierte Speicher ein Zone kann bis auf diesen Wert ausgelagert werden
  </dd>
</dl>
<p>
Neben dem Hauptspeicher kann man auch die CPUs regelmentieren. Man dedizierter CPUs zuweisen oder das Scheduling ver&auml;ndern. <a href="http://docs.sun.com/app/docs/doc/817-1592/rmfss-4?l=en&a=view">Hier</a> gibt eine gute &Uuml;bersicht, bzgl. der Definition der CPU Shares.</p>
<pre lang="bash">
root@global$ zonecfg -z myzone
zonecfg:myzone> add dedicated-cpu
zonecfg:myzone:dedicated-cpu> set ncpus=1-4
zonecfg:myzone:dedicated-cpu> end
zonecfg:myzone> exit
</pre>
<p>Was passiert nun?</p>
<ol>
<li>Beim booten der Zone werden die CPUs 1-4 werden aus dem default-Pool entfernt</li>
<li>Es wird ein tempor&auml;er Pool erstellt mit den CPUs 1-4</li>
<li>Beim stoppen der Zone werden die CPUs 1-4 wieder dem default-Pool zur verf&uuml;gung gestellt.</li>
</ol>
<p>Man kann auch sagen, dass eine Zone z.B. maximal 2,5 CPUs benutzen kann. Das sieht wie folgt aus:</p>
<pre lang="bash">
root@global$ zonecfg -z myzone
zonecfg:myzone> add capped-cpu
zonecfg:myzone:capped-cpu> set ncpus=2.5
zonecfg:myzone:capped-cpu> end
zonecfg:myzone> exit
</pre>
<p>Nun m&ouml;chte ich zeigen, wie man eine Zone 200 CPU-Shares und die FSS (Fair Share Scheduling) Klasse zuweist</p>
<pre lang="bash">
root@global$ zonecfg -z myzone
zonecfg:myzone> set cpu-shares=200
zonecfg:myzone> set scheduling-class=FSS
zonecfg:myzone> exit
</pre>
<p>Als letztes Quota zum Thema CPU m&ouml;chte ich zeigen, wie man die Anzahl der Threads/Prozesse begrenzt. Die folgende Zone kann maximal 250 Threads ausf&uuml;hren. Ein einzelner Prozess ohne Thredas z&auml;hlt als ein Thread.</p>
<pre lang="bash">
root@global$ zonecfg -z myzone
zonecfg:myzone> add rctl
zonecfg:myzone:rctl> set name=zone.max-lwps
zonecfg:myzone:rctl> add value (priv=privileged,limit=250,action=deny)
zonecfg:myzone:rctl> end
</pre>
<p>Man kann auf diese Weise auch noch andere Resourcen kontrollieren. <a href="http://docs.sun.com/app/docs/doc/820-2316/rmctrls-1?l=de&a=view">Hier</a> findet man eine &Uuml;bersicher &uuml;ber die Resource Controls</p>
<p>F&uuml;r Zonen kann es auch interssant sein, den Plattenpatz zu begrenzen. Da in Open Solaris zfs das default-Dateisystem ist, kann man Quotas und Reservations &uuml;ber die entsprechenden zfs-Eigenschaften machen. Die Wurzel der Zone liegt auf dem Dateisystem <tt>zones/myzone</tt></p>
<pre lang="bash">
root@global$ zonecfg -z myzone zfs set quota=10g zones/myzone
root@global$ zonecfg -z myzone zfs set reservation=5g zones/myzone
</pre>
