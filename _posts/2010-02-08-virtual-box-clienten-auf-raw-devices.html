---
layout: post
title: Virtual Box-Clienten auf raw-Devices
categories:
- Solaris
- Tools
tags:
- OpenSolaris
- vbox
- zfs
status: publish
type: post
published: true
meta:
  _edit_last: '2'
author:
  login: rennecke
  email: michael.rennecke@gmail.com
  display_name: Michael Rennecke
  first_name: Michael
  last_name: Rennecke
---
<p>Dan man mit zfs kann man auch volumes anlegen kann, wollte ich mal testen, ob man auch einen <a href="http://www.virtualbox.org/">VirtualBox</a>-Client auch auf ein solches Volume installieren kann. Es benötige einiges an Vorbereitungen, aber es geht wie folgt:</p>
<ol>
<li> Volume erzeugen:
<pre lang="bash">rennecke@walhalla VirtualBox $ pfexec  zfs create -s -V 200g daten/vol_win</pre>
<p>man erzeugt hiermit ein Volume, welches 200 GB groß ist. Es fordert den Speicher erst an, wenn dieser benötigt wird.</p>
</li>
<li> VirtualBox-User Zugriff auf das raw-Device geben:
<pre lang="bash">rennecke@walhalla VirtualBox $ pfexec chown rennecke:staff /dev/zvol/rdsk/daten/vol_win
rennecke@walhalla VirtualBox $ pfexec chmod 660 /dev/zvol/rdsk/daten/vol_win</pre>
<p>Das Device VirtualBox bekannt geben. Ich möchte diese Platten nicht bei den virtuellen Platten liegen haben.</p>
<pre lang="bash">rennecke@walhalla VirtualBox $ mkdir ~/.VirtualBox/raw-disk
rennecke@walhalla VirtualBox $ cd /opt/VirtualBox/
rennecke@walhalla VirtualBox $ VBoxManage internalcommands createrawvmdk -filename /home/rennecke/.VirtualBox/raw-disk/windows-raw.vmdk -rawdisk /dev/zvol/rdsk/daten/vol_win -register</pre>
</li>
<li> Fertig: Nun kann man in VirtualBox auf das Volume zugreifen.</li>
</ol>
<p>Man sollte aber wissen, was man tut. Man kann sich mit dieser Vorgehensweise ganz schnell etwas kaputt machen, z.B. indem man VirtualBox das falsche raw-Device übergibt. Das ganze hat auch noch einen anderen Schönheitsfehler. Man kann keine Snapshots mit VirtualBox erzeugen. Diese werden als Datei im Dateisystem auf dem Host abgelegt. Man kann aber Snapshots mit zfs erstellen, um Sicherungen der Virtuellen Maschine zu haben. Vielleicht gibt es irgendwann eine VirtualBox-Version, welche Features von zfs nutzt.</p>
